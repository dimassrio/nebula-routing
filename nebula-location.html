<!--
@license
Copyright (c) 2016 Ars Nebula LLC.
This code may be used under the terms found in LICENSE.md of this repository.
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="qs.html">

<!--
`<nebula-location>` is a custom element to support data-binding to the pathname and parsed query parameters of `window.location`. Location data is automatically updated when a `window.popstate` event is triggered.

@demo demo/index.html
-->

<script>
  Polymer({
    is: 'nebula-location',
    hostAttributes: {
      'hidden': true
    },
    properties: {
      data: {
        type: String,
        notify: true,
        readOnly: true
      }
    },
    /**
    * Window event handler triggered when **window.popstate** is fired.
    * Updates the **location.search** property.
    */
    _onPopState: function(e) {
      this._setData({
        pathname: window.location.pathname,
        queryParams: QS(window.location.search).getAll()
      })
    },
    /**
    * Lifecycle event handler triggered when element is attached to the DOM.
    * Adds a **window.popstate** event listener.
    */
    attached: function() {
      this.listen(window, 'popstate', '_onPopState')
      this._setData({
        pathname: window.location.pathname,
        queryParams: QS(window.location.search).getAll()
      })
    },
    /**
    * Lifecycle event handler triggered when element is detached from the DOM.
    * Removes **window.popstate** event listener.
    */
    detached: function() {
      this.unlisten(window, 'popstate', '_onPopState')
    }
  })
</script>