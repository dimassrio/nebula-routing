<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../nebula-element-mixin/nebula-element-mixin.html">
<link rel="import" href="qs.html">

<script>
(function() {
  'use strict'

  // symbols for private members
  const parseLocation = Symbol()

  // symbols for protected members
  const listen = Symbol.for('Nebula.ElementMixin.listen')
  const unlisten = Symbol.for('Nebula.ElementMixin.unlisten')

  /**
   * Validate forms and data with Validate.js
   */
  class NebulaLocation extends Nebula.ElementMixin(Polymer.Element) {

    /**
     * Gets the custom element name.
     * @type {string}
     */
    static get is() { return 'nebula-location' }

    /**
     * Gets the property definitions for data binding.
     * @type {Object}
     * @property {Object} data - Parsed location data.
     */
    static get properties() {
      return {
        data: {
          type: Object,
          notify: true,
          readOnly: true
        }
      }
    }

    /**
     * Lifecycle callback handler triggered when data-binding initialization is complete.
     * @public
     */
    ready() {
      super.ready();
      this.setAttribute('hidden', '')
    }

    /**
     * Lifecycle callback handler triggered when element is attached to the DOM.
     */
    connectedCallback() {
      super.connectedCallback()
      this[listen](window, 'popstate', this[parseLocation])
      this[parseLocation]()
    }

    /**
     * Lifecycle callback handler triggered when element is detached from the DOM.
     */
    disconnectedCallback() {
      super.disconnectedCallback()
      this[unlisten](window, 'popstate', this[parseLocation])
    }

    /**
     * Parse the window location and update location data.
     * @private
     */
    [parseLocation]() {
      this._setData({
        pathname: window.location.pathname,
        hash: window.location.hash,
        queryParams: QS(window.location.search).getAll()
      })
    }
  }

  customElements.define(NebulaLocation.is, NebulaLocation)
}())
</script>